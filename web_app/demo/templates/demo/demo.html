<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    {% load static %}

    <link href="https://uploads-ssl.webflow.com/5e7ceb09657a69bdab054b3a/5ea9d03561073b122a2bcf58_favicon.png"
        rel="shortcut icon" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel='stylesheet' href='https://unpkg.com/leaflet@1.6.0/dist/leaflet.css' />

    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

    <link rel="stylesheet" type="text/css" href="{% static 'demo/style.css' %}">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src='https://unpkg.com/leaflet@1.6.0/dist/leaflet.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.6.2/proj4.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.min.js'></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/7.1.0/math.min.js"></script>

    <script src="{% static "demo/countries-110m.js" %}"></script>
    <script src="{% static "demo/map.js" %}"></script>
    <script src="{% static "demo/dropdown.js" %}"></script>
    <script src="{% static "demo/transmission.js" %}"></script>

    <title>Starlink Simulator</title>
</head>

<body>
    <div class="container">
        <div class="row top-buffer">
            <div class="jumbotron m-0 p-3">
                <h2>Starlink Network Simulator</h2>
                <hr class="m-0 p-1">
                <div class="row top-buffer-sm">
                    <div class="col-sm-12 col-md-9">
                        <p>This is a demonstration of how Memgraph DB can be used to calculate the shortest path
                            for data transmission using a satellite network. For more information, visit our blog post:
                        </p>
                    </div>
                    <div class="col-sm-12 col-md-3">
                        <a class="btn btn-primary btn-lg" target="_blank" rel="noopener noreferrer"
                            href="https://memgraph.com/blog" role="button">BLOG POST</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row top-buffer">
            <div class="card" style="width: 100%; height:60vh; border-radius: 10px;">
                <div class="card-body" id="map"></div>
                <div id='map-alert'></div>
            </div>
        </div>
        <div class="row top-buffer">
            <div class="col-sm-12 col-md-6">
                <div class="row top-buffer">
                    <div class="col-sm-6 col-md-5">
                        <button type="button" class="btn btn-primary mb-3" id="startButton"
                            onclick="simulationStarted()">Start
                            simulation</button>
                    </div>
                    <div class="col-sm-6 col-md-5">
                        <button type="button" class="btn btn-warning" id="stopButton" onclick="simulationStopped()">Stop
                            simulation</button>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-sm-6 col-md-5">
                        <div class="form-group">
                            <select class="form-control form-control-md" id="dropdownOne"
                                onchange="if (this.selectedIndex!=-1)  dropdownOneSelect();">Select
                                starting city</select>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-5">
                        <div class="form-group">
                            <select class="form-control form-control-md" id="dropdownTwo"
                                onchange="if (this.selectedIndex!=-1)  dropdownTwoSelect();">Select
                                ending
                                city</select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-6">
                <div class="card mb-3" style="width: 100%; border-radius: 10px;">
                    <div id='tt-alert'></div>
                    <div class="card-body">
                        <div id="ttime"></div>
                        <div id="optic"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static "demo/index.js" %}"></script>
    <script>
        createMap();

        cities = JSON.parse("{{city_markers|escapejs}}");
        opticalPaths = JSON.parse("{{op_markers|escapejs}}");

        createDropdowns();

        $(document).ready(function () {
            simulationStopped();
        })

        function ajaxCall() {
            var xhr = $.ajax({
                type: 'GET',
                url: "{% url 'json_satellites_and_relationships' %}",
                data: {
                    cityOne: document.getElementById("dropdownOne").options[document.getElementById("dropdownOne").selectedIndex].value,
                    cityTwo: document.getElementById("dropdownTwo").options[document.getElementById("dropdownTwo").selectedIndex].value,
                    "json_satellites": json_satellites,
                    "json_relationships": json_relationships,
                    "json_shortest_path": json_shortest_path
                },
                async: true,
                success: function (data) {
                    if (!simStopped) {
                        drawCities();
                        drawRelationships(JSON.parse(data.json_relationships));
                        drawSatellites(JSON.parse(data.json_satellites));
                        if (data.json_shortest_path.length != 0) {
                            drawShortestPath(JSON.parse(data.json_shortest_path));
                            document.getElementById("ttime").innerHTML = "Satellite communication: " + transmission_time(JSON.parse(data.json_shortest_path));
                            selectedCities = GetSelectionText();
                            document.getElementById("optic").innerHTML = "Fiber-optic cable communication: " + optical_time(opticalPaths, selectedCities[0], selectedCities[1]);
                        } else {
                            shortestPathLayer.clearLayers();
                            document.getElementById("ttime").innerHTML = "No visible satellites.";
                            selectedCities = GetSelectionText();
                            document.getElementById("optic").innerHTML = "Fiber-optic cable communication: " + optical_time(opticalPaths, selectedCities[0], selectedCities[1]);
                        }
                    }
                },
                error: function (thrownError) {
                    alert(thrownError);
                }
            });
        };
    </script>
</body>

</html>